cmake_minimum_required(VERSION 3.7 FATAL_ERROR)

project(gtest CXX)

find_package(Threads)

# fused sources generated by https://github.com/google/googletest/blob/master/googlemock/scripts/fuse_gmock_files.py
add_library(gtest STATIC gtest/gtest.h gmock/gmock.h gmock_main.cc gmock-gtest-all.cc)

target_link_libraries(gtest PUBLIC Threads::Threads)

if (CMAKE_USE_PTHREADS_INIT)
    set(HAS_PTHREAD 1)
else()
    set(HAS_PTHREAD 0)
endif()

target_compile_definitions(gtest PUBLIC 
    GTEST_HAS_PTHREAD=${HAS_PTHREAD}
)

target_include_directories(gtest SYSTEM PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
